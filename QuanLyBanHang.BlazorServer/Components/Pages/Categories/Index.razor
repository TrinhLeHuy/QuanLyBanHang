@page "/categories"
@inject CategoriesService CategoriesService
@inject NavigationManager Navigation
@inject IJSRuntime JS

<h2>Danh sách Danh Mục Sản Phẩm</h2>

<p>
    <button class="btn btn-primary" @onclick="CreateCategory">+ Thêm Danh Mục</button>
</p>

@if (categories == null)
{
    <p>Loading...</p>
}
else
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Tên danh mục</th>
                <th>Mô tả</th>
                <th>Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in categories)
            {
                <tr>
                    <td>@item.Name</td>
                    <td>@item.Description</td>
                    <td>
                        <button class="btn btn-warning btn-sm" @onclick="() => EditCategory(item.Id)">Sửa</button>
                        <button class="btn btn-danger btn-sm" @onclick="() => DeleteCategory(item.Id)">Xóa</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<Categories>? categories;

    protected override async Task OnInitializedAsync()
    {
        categories = await CategoriesService.GetAllAsync();
    }

    void CreateCategory() => Navigation.NavigateTo("/categories/create");
    void EditCategory(int id) => Navigation.NavigateTo($"/categories/edit/{id}");

    async Task DeleteCategory(int id)
    {
        bool success = await CategoriesService.DeleteAsync(id);
        if (!success)
        {
            await JS.InvokeVoidAsync("alert", "Không thể xóa danh mục có sản phẩm.");
        }
        categories = await CategoriesService.GetAllAsync();
    }
}
